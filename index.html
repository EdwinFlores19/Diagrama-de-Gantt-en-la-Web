import React, { useState, useEffect, useRef } from 'react';
import { 
  Calendar, 
  Users, 
  Clock, 
  DollarSign, 
  BarChart3, 
  FileText, 
  Settings, 
  Plus, 
  Trash2, 
  Edit, 
  Save, 
  Filter, 
  Search, 
  Download, 
  Upload, 
  ChevronRight, 
  ChevronDown,
  AlertTriangle,
  CheckCircle,
  Circle,
  Play,
  Pause,
  Target,
  TrendingUp,
  PieChart,
  Gantt
} from 'lucide-react';

const ProjectManager = () => {
  // Estados principales
  const [activeView, setActiveView] = useState('gantt');
  const [projects, setProjects] = useState([
    {
      id: 1,
      name: 'Desarrollo Sistema Web',
      startDate: '2024-01-15',
      endDate: '2024-06-30',
      status: 'En Progreso',
      progress: 65,
      budget: 50000,
      spent: 32500,
      manager: 'Ana García',
      priority: 'Alta'
    }
  ]);
  
  const [tasks, setTasks] = useState([
    {
      id: 1,
      projectId: 1,
      name: 'Análisis de Requerimientos',
      startDate: '2024-01-15',
      endDate: '2024-02-15',
      duration: 31,
      progress: 100,
      priority: 'Alta',
      assignee: 'Juan Pérez',
      status: 'Completado',
      predecessors: [],
      cost: 8000,
      level: 0,
      expanded: true,
      type: 'task'
    },
    {
      id: 2,
      projectId: 1,
      name: 'Diseño del Sistema',
      startDate: '2024-02-16',
      endDate: '2024-03-31',
      duration: 44,
      progress: 85,
      priority: 'Alta',
      assignee: 'María López',
      status: 'En Progreso',
      predecessors: [1],
      cost: 12000,
      level: 0,
      expanded: true,
      type: 'task'
    },
    {
      id: 3,
      projectId: 1,
      name: 'Desarrollo Frontend',
      startDate: '2024-04-01',
      endDate: '2024-05-31',
      duration: 61,
      progress: 45,
      priority: 'Media',
      assignee: 'Carlos Ruiz',
      status: 'En Progreso',
      predecessors: [2],
      cost: 15000,
      level: 0,
      expanded: true,
      type: 'task'
    },
    {
      id: 4,
      projectId: 1,
      name: 'Desarrollo Backend',
      startDate: '2024-04-15',
      endDate: '2024-06-15',
      duration: 62,
      progress: 30,
      priority: 'Alta',
      assignee: 'Luis Martín',
      status: 'En Progreso',
      predecessors: [2],
      cost: 18000,
      level: 0,
      expanded: true,
      type: 'task'
    }
  ]);

  const [resources, setResources] = useState([
    {
      id: 1,
      name: 'Juan Pérez',
      role: 'Analista',
      email: 'juan@empresa.com',
      hourlyRate: 25,
      availability: 100,
      skills: ['Análisis', 'Documentación']
    },
    {
      id: 2,
      name: 'María López',
      role: 'Diseñadora UX',
      email: 'maria@empresa.com',
      hourlyRate: 30,
      availability: 80,
      skills: ['UX/UI', 'Prototipado']
    },
    {
      id: 3,
      name: 'Carlos Ruiz',
      role: 'Developer Frontend',
      email: 'carlos@empresa.com',
      hourlyRate: 35,
      availability: 100,
      skills: ['React', 'JavaScript', 'CSS']
    },
    {
      id: 4,
      name: 'Luis Martín',
      role: 'Developer Backend',
      email: 'luis@empresa.com',
      hourlyRate: 40,
      availability: 90,
      skills: ['Node.js', 'Database', 'API']
    }
  ]);

  const [selectedTask, setSelectedTask] = useState(null);
  const [showTaskModal, setShowTaskModal] = useState(false);
  const [showResourceModal, setShowResourceModal] = useState(false);
  const [ganttScale, setGanttScale] = useState('days');
  const [filters, setFilters] = useState({
    status: '',
    priority: '',
    assignee: '',
    dateRange: ''
  });

  // Funciones de gestión de tareas
  const addTask = (taskData) => {
    const newTask = {
      id: Date.now(),
      projectId: 1,
      ...taskData,
      level: 0,
      expanded: true,
      type: 'task'
    };
    setTasks([...tasks, newTask]);
  };

  const updateTask = (taskId, updatedData) => {
    setTasks(tasks.map(task => 
      task.id === taskId ? { ...task, ...updatedData } : task
    ));
  };

  const deleteTask = (taskId) => {
    setTasks(tasks.filter(task => task.id !== taskId));
  };

  // Funciones de cálculo
  const calculateTaskPosition = (startDate, duration) => {
    const start = new Date(startDate);
    const projectStart = new Date('2024-01-15');
    const daysDiff = Math.floor((start - projectStart) / (1000 * 60 * 60 * 24));
    return {
      left: daysDiff * 30,
      width: duration * 30
    };
  };

  const getStatusColor = (status) => {
    switch (status) {
      case 'Completado': return 'bg-green-500';
      case 'En Progreso': return 'bg-blue-500';
      case 'Pendiente': return 'bg-gray-400';
      case 'Retrasado': return 'bg-red-500';
      default: return 'bg-gray-400';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'Alta': return 'text-red-600';
      case 'Media': return 'text-yellow-600';
      case 'Baja': return 'text-green-600';
      default: return 'text-gray-600';
    }
  };

  // Componente de Modal para Tareas
  const TaskModal = ({ task, onSave, onClose }) => {
    const [formData, setFormData] = useState(task || {
      name: '',
      startDate: '',
      endDate: '',
      duration: '',
      assignee: '',
      priority: 'Media',
      status: 'Pendiente',
      progress: 0,
      cost: 0,
      predecessors: []
    });

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white rounded-lg p-6 w-96 max-h-[90vh] overflow-y-auto">
          <h3 className="text-lg font-semibold mb-4">
            {task ? 'Editar Tarea' : 'Nueva Tarea'}
          </h3>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Nombre</label>
              <input
                type="text"
                className="w-full border rounded px-3 py-2"
                value={formData.name}
                onChange={(e) => setFormData({...formData, name: e.target.value})}
              />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Fecha Inicio</label>
                <input
                  type="date"
                  className="w-full border rounded px-3 py-2"
                  value={formData.startDate}
                  onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Fecha Fin</label>
                <input
                  type="date"
                  className="w-full border rounded px-3 py-2"
                  value={formData.endDate}
                  onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                />
              </div>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Duración (días)</label>
                <input
                  type="number"
                  className="w-full border rounded px-3 py-2"
                  value={formData.duration}
                  onChange={(e) => setFormData({...formData, duration: parseInt(e.target.value)})}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Progreso (%)</label>
                <input
                  type="number"
                  min="0"
                  max="100"
                  className="w-full border rounded px-3 py-2"
                  value={formData.progress}
                  onChange={(e) => setFormData({...formData, progress: parseInt(e.target.value)})}
                />
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium mb-1">Asignado a</label>
              <select
                className="w-full border rounded px-3 py-2"
                value={formData.assignee}
                onChange={(e) => setFormData({...formData, assignee: e.target.value})}
              >
                <option value="">Seleccionar...</option>
                {resources.map(resource => (
                  <option key={resource.id} value={resource.name}>
                    {resource.name}
                  </option>
                ))}
              </select>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Prioridad</label>
                <select
                  className="w-full border rounded px-3 py-2"
                  value={formData.priority}
                  onChange={(e) => setFormData({...formData, priority: e.target.value})}
                >
                  <option value="Baja">Baja</option>
                  <option value="Media">Media</option>
                  <option value="Alta">Alta</option>
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Estado</label>
                <select
                  className="w-full border rounded px-3 py-2"
                  value={formData.status}
                  onChange={(e) => setFormData({...formData, status: e.target.value})}
                >
                  <option value="Pendiente">Pendiente</option>
                  <option value="En Progreso">En Progreso</option>
                  <option value="Completado">Completado</option>
                  <option value="Retrasado">Retrasado</option>
                </select>
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium mb-1">Costo</label>
              <input
                type="number"
                className="w-full border rounded px-3 py-2"
                value={formData.cost}
                onChange={(e) => setFormData({...formData, cost: parseInt(e.target.value)})}
              />
            </div>
          </div>
          
          <div className="flex justify-end gap-2 mt-6">
            <button
              onClick={onClose}
              className="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50"
            >
              Cancelar
            </button>
            <button
              onClick={() => {
                onSave(formData);
                onClose();
              }}
              className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
            >
              Guardar
            </button>
          </div>
        </div>
      </div>
    );
};

export default ProjectManager;
  };

  // Vista de Gantt
  const GanttView = () => {
    return (
      <div className="bg-white rounded-lg shadow overflow-hidden">
        <div className="p-4 border-b bg-gray-50">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-semibold">Diagrama de Gantt</h2>
            <div className="flex gap-2">
              <select 
                value={ganttScale}
                onChange={(e) => setGanttScale(e.target.value)}
                className="border rounded px-3 py-1"
              >
                <option value="days">Días</option>
                <option value="weeks">Semanas</option>
                <option value="months">Meses</option>
              </select>
              <button
                onClick={() => setShowTaskModal(true)}
                className="bg-blue-600 text-white px-3 py-1 rounded flex items-center gap-1"
              >
                <Plus size={16} />
                Nueva Tarea
              </button>
            </div>
          </div>
        </div>
        
        <div className="overflow-auto max-h-96">
          <div className="flex">
            {/* Columna de tareas */}
            <div className="w-80 border-r">
              <div className="bg-gray-100 p-2 border-b font-semibold">Tareas</div>
              {tasks.map(task => (
                <div key={task.id} className="border-b p-3 hover:bg-gray-50">
                  <div className="font-medium">{task.name}</div>
                  <div className="text-sm text-gray-600">
                    {task.assignee} • {task.duration} días • {task.progress}%
                  </div>
                  <div className="flex items-center gap-2 mt-1">
                    <span className={`text-xs px-2 py-1 rounded ${getStatusColor(task.status)} text-white`}>
                      {task.status}
                    </span>
                    <span className={`text-xs ${getPriorityColor(task.priority)}`}>
                      {task.priority}
                    </span>
                  </div>
                </div>
              ))}
            </div>
            
            {/* Timeline */}
            <div className="flex-1 min-w-0">
              <div className="bg-gray-100 p-2 border-b">
                <div className="flex">
                  {Array.from({length: 30}, (_, i) => (
                    <div key={i} className="w-8 text-xs text-center border-r">
                      {i + 1}
                    </div>
                  ))}
                </div>
              </div>
              
              {tasks.map(task => {
                const position = calculateTaskPosition(task.startDate, task.duration);
                return (
                  <div key={task.id} className="h-16 border-b relative">
                    <div 
                      className={`absolute top-2 h-6 ${getStatusColor(task.status)} rounded flex items-center px-2`}
                      style={{
                        left: `${Math.max(0, position.left)}px`,
                        width: `${Math.max(30, position.width)}px`
                      }}
                    >
                      <div className="w-full bg-white bg-opacity-30 rounded-full h-1">
                        <div 
                          className="bg-white h-1 rounded-full"
                          style={{ width: `${task.progress}%` }}
                        />
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Vista de Lista de Tareas
  const TaskListView = () => {
    return (
      <div className="bg-white rounded-lg shadow">
        <div className="p-4 border-b bg-gray-50">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-semibold">Lista de Tareas</h2>
            <div className="flex gap-2">
              <button className="border rounded px-3 py-1 flex items-center gap-1">
                <Filter size={16} />
                Filtros
              </button>
              <button
                onClick={() => setShowTaskModal(true)}
                className="bg-blue-600 text-white px-3 py-1 rounded flex items-center gap-1"
              >
                <Plus size={16} />
                Nueva Tarea
              </button>
            </div>
          </div>
        </div>
        
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="text-left p-3">Tarea</th>
                <th className="text-left p-3">Asignado</th>
                <th className="text-left p-3">Inicio</th>
                <th className="text-left p-3">Fin</th>
                <th className="text-left p-3">Duración</th>
                <th className="text-left p-3">Progreso</th>
                <th className="text-left p-3">Estado</th>
                <th className="text-left p-3">Prioridad</th>
                <th className="text-left p-3">Costo</th>
                <th className="text-left p-3">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {tasks.map(task => (
                <tr key={task.id} className="border-b hover:bg-gray-50">
                  <td className="p-3 font-medium">{task.name}</td>
                  <td className="p-3">{task.assignee}</td>
                  <td className="p-3">{task.startDate}</td>
                  <td className="p-3">{task.endDate}</td>
                  <td className="p-3">{task.duration} días</td>
                  <td className="p-3">
                    <div className="flex items-center gap-2">
                      <div className="w-16 bg-gray-200 rounded-full h-2">
                        <div 
                          className="bg-blue-600 h-2 rounded-full"
                          style={{ width: `${task.progress}%` }}
                        />
                      </div>
                      <span className="text-sm">{task.progress}%</span>
                    </div>
                  </td>
                  <td className="p-3">
                    <span className={`px-2 py-1 rounded text-xs ${getStatusColor(task.status)} text-white`}>
                      {task.status}
                    </span>
                  </td>
                  <td className={`p-3 ${getPriorityColor(task.priority)}`}>
                    {task.priority}
                  </td>
                  <td className="p-3">${task.cost?.toLocaleString()}</td>
                  <td className="p-3">
                    <div className="flex gap-1">
                      <button 
                        onClick={() => {
                          setSelectedTask(task);
                          setShowTaskModal(true);
                        }}
                        className="p-1 hover:bg-gray-200 rounded"
                      >
                        <Edit size={16} />
                      </button>
                      <button 
                        onClick={() => deleteTask(task.id)}
                        className="p-1 hover:bg-gray-200 rounded text-red-600"
                      >
                        <Trash2 size={16} />
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    );
  };

  // Vista de Recursos
  const ResourceView = () => {
    return (
      <div className="bg-white rounded-lg shadow">
        <div className="p-4 border-b bg-gray-50">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-semibold">Gestión de Recursos</h2>
            <button 
              onClick={() => setShowResourceModal(true)}
              className="bg-blue-600 text-white px-3 py-1 rounded flex items-center gap-1"
            >
              <Plus size={16} />
              Nuevo Recurso
            </button>
          </div>
        </div>
        
        <div className="p-4">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {resources.map(resource => (
              <div key={resource.id} className="border rounded-lg p-4">
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                    <Users size={20} className="text-blue-600" />
                  </div>
                  <div>
                    <h3 className="font-medium">{resource.name}</h3>
                    <p className="text-sm text-gray-600">{resource.role}</p>
                  </div>
                </div>
                
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span>Email:</span>
                    <span>{resource.email}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Tarifa/hora:</span>
                    <span>${resource.hourlyRate}</span>
                  </div>
                  <div className="flex justify-between">
                    <span>Disponibilidad:</span>
                    <span>{resource.availability}%</span>
                  </div>
                </div>
                
                <div className="mt-3">
                  <div className="text-sm font-medium mb-1">Habilidades:</div>
                  <div className="flex flex-wrap gap-1">
                    {resource.skills.map((skill, index) => (
                      <span key={index} className="px-2 py-1 bg-gray-100 rounded text-xs">
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
                
                <div className="mt-3">
                  <div className="text-sm font-medium mb-1">Disponibilidad:</div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      className="bg-green-600 h-2 rounded-full"
                      style={{ width: `${resource.availability}%` }}
                    />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  // Vista de Dashboard
  const DashboardView = () => {
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(t => t.status === 'Completado').length;
    const inProgressTasks = tasks.filter(t => t.status === 'En Progreso').length;
    const totalCost = tasks.reduce((sum, task) => sum + (task.cost || 0), 0);
    const avgProgress = tasks.reduce((sum, task) => sum + task.progress, 0) / totalTasks;

    return (
      <div className="space-y-6">
        {/* KPIs */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div className="bg-white p-6 rounded-lg shadow">
            <div className="flex items-center">
              <div className="p-2 bg-blue-100 rounded-lg">
                <FileText className="h-6 w-6 text-blue-600" />
              </div>
              <div className="ml-4">
                <p className="text-sm font-medium text-gray-600">Total Tareas</p>
                <p className="text-2xl font-semibold text-gray-900">{totalTasks}</p>
              </div>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <div className="flex items-center">
              <div className="p-2 bg-green-100 rounded-lg">
                <CheckCircle className="h-6 w-6 text-green-600" />
              </div>
              <div className="ml-4">
                <p className="text-sm font-medium text-gray-600">Completadas</p>
                <p className="text-2xl font-semibold text-gray-900">{completedTasks}</p>
              </div>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <div className="flex items-center">
              <div className="p-2 bg-yellow-100 rounded-lg">
                <Clock className="h-6 w-6 text-yellow-600" />
              </div>
              <div className="ml-4">
                <p className="text-sm font-medium text-gray-600">En Progreso</p>
                <p className="text-2xl font-semibold text-gray-900">{inProgressTasks}</p>
              </div>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <div className="flex items-center">
              <div className="p-2 bg-purple-100 rounded-lg">
                <DollarSign className="h-6 w-6 text-purple-600" />
              </div>
              <div className="ml-4">
                <p className="text-sm font-medium text-gray-600">Costo Total</p>
                <p className="text-2xl font-semibold text-gray-900">${totalCost.toLocaleString()}</p>
              </div>
            </div>
          </div>
        </div>

        {/* Gráficos y estadísticas */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Progreso del Proyecto</h3>
            <div className="space-y-4">
              <div className="flex justify-between items-center">
                <span>Progreso General</span>
                <span>{Math.round(avgProgress)}%</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-4">
                <div 
                  className="bg-blue-600 h-4 rounded-full"
                  style={{ width: `${avgProgress}%` }}
                />
              </div>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Estado de Tareas</h3>
            <div className="space-y-3">
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-green-500 rounded-full"></div>
                  <span>Completadas</span>
                </div>
                <span>{completedTasks}</span>
              </div>
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                  <span>En Progreso</span>
                </div>
                <span>{inProgressTasks}</span>
              </div>
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 bg-gray-400 rounded-full"></div>
                  <span>Pendientes</span>
                </div>
                <span>{totalTasks - completedTasks - inProgressTasks}</span>
              </div>
            </div>
          </div>
        </div>

        {/* Tareas críticas y próximos vencimientos */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Tareas de Alta Prioridad</h3>
            <div className="space-y-3">
              {tasks.filter(task => task.priority === 'Alta').map(task => (
                <div key={task.id} className="flex items-center justify-between p-3 bg-red-50 rounded">
                  <div>
                    <div className="font-medium">{task.name}</div>
                    <div className="text-sm text-gray-600">{task.assignee}</div>
                  </div>
                  <div className="text-sm">
                    <div>{task.progress}%</div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow">
            <h3 className="text-lg font-semibold mb-4">Uso de Recursos</h3>
            <div className="space-y-3">
              {resources.map(resource => (
                <div key={resource.id} className="flex items-center justify-between">
                  <div>
                    <div className="font-medium">{resource.name}</div>
                    <div className="text-sm text-gray-600">{resource.role}</div>
                  </div>
                  <div className="flex items-center gap-2">
                    <div className="w-16 bg-gray-200 rounded-full h-2">
                      <div 
                        className="bg-blue-600 h-2 rounded-full"
                        style={{ width: `${resource.availability}%` }}
                      />
                    </div>
                    <span className="text-sm">{resource.availability}%</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Vista de Calendario
  const CalendarView = () => {
    const [currentDate, setCurrentDate] = useState(new Date());
    const [calendarTasks, setCalendarTasks] = useState(tasks);

    const getDaysInMonth = (date) => {
      return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
    };

    const getFirstDayOfMonth = (date) => {
      return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    };

    const renderCalendar = () => {
      const daysInMonth = getDaysInMonth(currentDate);
      const firstDay = getFirstDayOfMonth(currentDate);
      const days = [];

      // Días vacíos del mes anterior
      for (let i = 0; i < firstDay; i++) {
        days.push(<div key={`empty-${i}`} className="p-2"></div>);
      }

      // Días del mes actual
      for (let day = 1; day <= daysInMonth; day++) {
        const dayTasks = calendarTasks.filter(task => {
          const taskStart = new Date(task.startDate);
          const taskEnd = new Date(task.endDate);
          const currentDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
          return currentDay >= taskStart && currentDay <= taskEnd;
        });

        days.push(
          <div key={day} className="border p-2 min-h-[100px] bg-white">
            <div className="font-semibold text-sm mb-1">{day}</div>
            {dayTasks.map(task => (
              <div
                key={task.id}
                className={`text-xs p-1 mb-1 rounded ${getStatusColor(task.status)} text-white truncate`}
                title={task.name}
              >
                {task.name}
              </div>
            ))}
          </div>
        );
      }

      return days;
    };

    return (
      <div className="bg-white rounded-lg shadow">
        <div className="p-4 border-b bg-gray-50">
          <div className="flex justify-between items-center">
            <h2 className="text-lg font-semibold">Vista de Calendario</h2>
            <div className="flex items-center gap-4">
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth() - 1)))}
                  className="p-1 hover:bg-gray-200 rounded"
                >
                  &lt;
                </button>
                <span className="font-medium">
                  {currentDate.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' })}
                </span>
                <button
                  onClick={() => setCurrentDate(new Date(currentDate.setMonth(currentDate.getMonth() + 1)))}
                  className="p-1 hover:bg-gray-200 rounded"
                >
                  &gt;
                </button>
              </div>
              <button
                onClick={() => setShowTaskModal(true)}
                className="bg-blue-600 text-white px-3 py-1 rounded flex items-center gap-1"
              >
                <Plus size={16} />
                Nueva Tarea
              </button>
            </div>
          </div>
        </div>

        <div className="p-4">
          <div className="grid grid-cols-7 gap-1 mb-4">
            {['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'].map(day => (
              <div key={day} className="p-2 text-center font-semibold bg-gray-100">
                {day}
              </div>
            ))}
          </div>
          <div className="grid grid-cols-7 gap-1">
            {renderCalendar()}
          </div>
        </div>
      </div>
    );
  };

  // Vista de Reportes
  const ReportsView = () => {
    const generateReport = (type) => {
      // Aquí se generaría el reporte según el tipo
      alert(`Generando reporte de ${type}...`);
    };

    return (
      <div className="space-y-6">
        <div className="bg-white rounded-lg shadow p-6">
          <h2 className="text-lg font-semibold mb-4">Generador de Reportes</h2>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <BarChart3 className="text-blue-600" size={24} />
                <h3 className="font-medium">Reporte de Progreso</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Análisis detallado del progreso de tareas y proyectos
              </p>
              <button
                onClick={() => generateReport('progreso')}
                className="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700"
              >
                Generar Reporte
              </button>
            </div>

            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <Users className="text-green-600" size={24} />
                <h3 className="font-medium">Reporte de Recursos</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Utilización y disponibilidad de recursos del proyecto
              </p>
              <button
                onClick={() => generateReport('recursos')}
                className="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700"
              >
                Generar Reporte
              </button>
            </div>

            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <DollarSign className="text-purple-600" size={24} />
                <h3 className="font-medium">Reporte Financiero</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Análisis de costos, presupuestos y gastos del proyecto
              </p>
              <button
                onClick={() => generateReport('financiero')}
                className="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700"
              >
                Generar Reporte
              </button>
            </div>

            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <Clock className="text-yellow-600" size={24} />
                <h3 className="font-medium">Reporte de Tiempo</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Análisis de tiempos, duraciones y cronograma
              </p>
              <button
                onClick={() => generateReport('tiempo')}
                className="w-full bg-yellow-600 text-white py-2 rounded hover:bg-yellow-700"
              >
                Generar Reporte
              </button>
            </div>

            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <AlertTriangle className="text-red-600" size={24} />
                <h3 className="font-medium">Reporte de Riesgos</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Identificación y análisis de riesgos del proyecto
              </p>
              <button
                onClick={() => generateReport('riesgos')}
                className="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700"
              >
                Generar Reporte
              </button>
            </div>

            <div className="border rounded-lg p-4">
              <div className="flex items-center gap-3 mb-3">
                <Target className="text-indigo-600" size={24} />
                <h3 className="font-medium">Reporte Ejecutivo</h3>
              </div>
              <p className="text-sm text-gray-600 mb-4">
                Resumen ejecutivo del estado general del proyecto
              </p>
              <button
                onClick={() => generateReport('ejecutivo')}
                className="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700"
              >
                Generar Reporte
              </button>
            </div>
          </div>
        </div>

        {/* Reportes rápidos */}
        <div className="bg-white rounded-lg shadow p-6">
          <h3 className="text-lg font-semibold mb-4">Métricas Rápidas</h3>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="text-center">
              <div className="text-3xl font-bold text-blue-600 mb-2">
                {Math.round((tasks.filter(t => t.status === 'Completado').length / tasks.length) * 100)}%
              </div>
              <div className="text-sm text-gray-600">Tareas Completadas</div>
            </div>
            
            <div className="text-center">
              <div className="text-3xl font-bold text-green-600 mb-2">
                {tasks.filter(t => new Date(t.endDate) > new Date()).length}
              </div>
              <div className="text-sm text-gray-600">Tareas a Tiempo</div>
            </div>
            
            <div className="text-center">
              <div className="text-3xl font-bold text-purple-600 mb-2">
                ${tasks.reduce((sum, task) => sum + (task.cost || 0), 0).toLocaleString()}
              </div>
              <div className="text-sm text-gray-600">Presupuesto Utilizado</div>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Renderizar la vista activa
  const renderActiveView = () => {
    switch (activeView) {
      case 'dashboard':
        return <DashboardView />;
      case 'gantt':
        return <GanttView />;
      case 'tasks':
        return <TaskListView />;
      case 'calendar':
        return <CalendarView />;
      case 'resources':
        return <ResourceView />;
      case 'reports':
        return <ReportsView />;
      default:
        return <DashboardView />;
    }
  };

  return (
    <div className="min-h-screen bg-gray-100">
      {/* Header */}
      <header className="bg-white shadow-sm border-b">
        <div className="px-6 py-4">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-2xl font-bold text-gray-900">Project Manager Pro</h1>
              <p className="text-gray-600">Sistema de Gestión de Proyectos Completo</p>
            </div>
            <div className="flex items-center gap-4">
              <button className="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50">
                <Upload size={16} />
                Importar
              </button>
              <button className="flex items-center gap-2 px-3 py-2 border rounded hover:bg-gray-50">
                <Download size={16} />
                Exportar
              </button>
              <button className="flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                <Save size={16} />
                Guardar
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <nav className="bg-white border-b">
        <div className="px-6">
          <div className="flex space-x-8">
            {[
              { key: 'dashboard', label: 'Dashboard', icon: BarChart3 },
              { key: 'gantt', label: 'Gantt', icon: Gantt },
              { key: 'tasks', label: 'Tareas', icon: FileText },
              { key: 'calendar', label: 'Calendario', icon: Calendar },
              { key: 'resources', label: 'Recursos', icon: Users },
              { key: 'reports', label: 'Reportes', icon: TrendingUp }
            ].map((item) => {
              const Icon = item.icon;
              return (
                <button
                  key={item.key}
                  onClick={() => setActiveView(item.key)}
                  className={`flex items-center gap-2 px-3 py-4 border-b-2 transition-colors ${
                    activeView === item.key
                      ? 'border-blue-600 text-blue-600'
                      : 'border-transparent text-gray-600 hover:text-gray-900'
                  }`}
                >
                  <Icon size={18} />
                  {item.label}
                </button>
              );
            })}
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="px-6 py-6">
        {renderActiveView()}
      </main>

      {/* Modals */}
      {showTaskModal && (
        <TaskModal
          task={selectedTask}
          onSave={(taskData) => {
            if (selectedTask) {
              updateTask(selectedTask.id, taskData);
            } else {
              addTask(taskData);
            }
            setSelectedTask(null);
          }}
          onClose={() => {
            setShowTaskModal(false);
            setSelectedTask(null);
          }}
        />
      )}

      {/* Modal de Recursos */}
      {showResourceModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-96">
            <h3 className="text-lg font-semibold mb-4">Nuevo Recurso</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Nombre</label>
                <input type="text" className="w-full border rounded px-3 py-2" />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Rol</label>
                <input type="text" className="w-full border rounded px-3 py-2" />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Email</label>
                <input type="email" className="w-full border rounded px-3 py-2" />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Tarifa por Hora</label>
                <input type="number" className="w-full border rounded px-3 py-2" />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Disponibilidad (%)</label>
                <input type="number" min="0" max="100" className="w-full border rounded px-3 py-2" />
              </div>
            </div>
            
            <div className="flex justify-end gap-2 mt-6">
              <button
                onClick={() => setShowResourceModal(false)}
                className="px-4 py-2 text-gray-600 border rounded hover:bg-gray-50"
              >
                Cancelar
              </button>
              <button
                onClick={() => setShowResourceModal(false)}
                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
              >
                Guardar
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );